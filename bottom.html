<!DOCTYPE html>
<html style="">

  <head>
    <meta charset="UTF-8">
    <link rel="stylesheet" type="text/css" href="css/teaser2.css">
    <link rel="stylesheet" type="text/css" href="css/powerwidgets.css">
    <link rel="stylesheet" type="text/css" href="css/bottom.css">
    <link href="https://fonts.googleapis.com/css?family=Montserrat" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Fredoka+One" rel="stylesheet">
    <base target="_parent">
    <script type="text/javascript" src="//city.power-h2020.eu/redesign_js/client.js"></script> <!-- need to include this script to talk with the api -->

  </head>
  <body onresize="resize()">
    <div class="powerTitle title_1">
    </div>
    <p class="paragraph_1"></p>
    <div style="margin-left:auto;margin-right: auto;text-align: center;">
      <canvas width="400" height="100" style="background-color:white" id="canvas"></canvas>
    </div>
    <div class="powerTitle title_2"></div>
    <div class="indicator indicatora">
      <div class="hideable-area">
        <div class="circularWrapper">
          <div class="svgWrapper">
            <div class="circularTitle" ><span class="problem_awareness" style="color: #6d0949;"></span><br><span style="font-size: small;"></span></div>
            <svg
               class="progress-ring"
               width="140"
               fill="#13377f"
               height="140"
               shape-rendering="geometricPrecision"
               >
              <circle
                id="circ_1"
                class="progress-ring__circle"
                transform="rotate(-90 0 0)"
                stroke="#6d0949"
                stroke-width="50"
                fill="#13377f"
                r="30"
                cx="70"
                cy="70"/>
              <circle
                stroke="white"
                stroke-width="2"
                fill="#6d0949"
                r="30"
                cx="70"
                cy="70"/>
              <circle
                stroke="#6d0949"
                stroke-width="2"
                fill="transparent"
                r="57"
                cx="70"
                cy="70"/>
              <line x1="0" y1="70" x2="140" y2="70" style="stroke:rgb(109,9,73);stroke-width:2"/>
              <line x1="70" y1="0" x2="70" y2="140" style="stroke:rgb(109,9,73);stroke-width:2"/>

              <image xlink:href="img/prob_awe.png" height="140" width="140"  rx="15" ry="15" />

            </svg>
            <div class="points_flex">
              <div class="points_row l">
                <div class="points_left" id="pa_points">
                  0
                </div>
              </div>
            </div>
          </div>
          <div class="svgWrapper">
            <div class="circularTitle" ><span class="know_how"></span><br> <span  style="font-size: small;"></span></div>

            <svg
               class="progress-ring"
               width="140"
               fill="#13377f"
               height="140"
               shape-rendering="geometricPrecision"
               >
              <circle
                class="progress-ring__circle"
                transform="rotate(-90 0 0)"
                stroke="#13377f"
                stroke-width="50"
                fill="#13377f"
                r="30"
                cx="70"
                cy="70"
                id="circ_2"
                />
              <circle
                stroke="white"
                stroke-width="2"
                fill="#13377f"
                r="30"
                cx="70"
                cy="70"/>
              <circle
                stroke="#13377f"
                stroke-width="2"
                fill="transparent"
                r="57"
                cx="70"
                cy="70"/>
                <line x1="0" y1="70" x2="140" y2="70" style="stroke:rgb(19,55,127);stroke-width:2"/>
                <line x1="70" y1="0" x2="70" y2="140" style="stroke:rgb(19,55,127);stroke-width:2"/>
              <image xlink:href="img/idea.png" height="140" width="140"  rx="15" ry="15" />
            </svg>
            <div class="points_flex">
              <div class="points_row l">
                <div class="points_left kh_bg" id="kh_points">
                  0
                </div>
              </div>
            </div>


          </div>

          <div class="svgWrapper">
            <div class="circularTitle" ><span class="ready_to_act" class="ra_txt"></span><br><span style="font-size: small;"></span></div>

            <svg
               class="progress-ring"
               width="140"
               fill="#493f8d"
               height="140"
               shape-rendering="geometricPrecision"
               >
              <circle
                class="progress-ring__circle"
                transform="rotate(-90 0 0)"
                stroke="#493f8d"
                stroke-width="50"
                fill="#493f8d"
                r="30"
                cx="70"
                cy="70"
                id="circ_3"
                />
              <circle
                stroke="white"
                stroke-width="2"
                fill="#493f8d"
                r="30"
                cx="70"
                cy="70"/>
              <circle
                stroke="#493f8d"
                stroke-width="2"
                fill="transparent"
                r="57"
                cx="70"
                cy="70"/>
                <line x1="0" y1="70" x2="140" y2="70" style="stroke:rgb(73,63,141);stroke-width:2"/>
                <line x1="70" y1="0" x2="70" y2="140" style="stroke:rgb(73,63,141);stroke-width:2"/>
              <image xlink:href="img/ready_act.png" height="140" width="140"  rx="15" ry="15" />
            </svg>
            <div class="points_flex">
              <div class="points_row l">
                <div class="points_left ra_bg" id="ra_points" >
                  0
                </div>
              </div>
            </div>

          </div>
      </div>
    </div>


    </div>
    <p style="text-align:center;" class="paragraph_2"><p>
    <p style="text-align:center;" class="paragraph_3"></p>
    <a class="start_now_button link6 join_button" href="" style="height: 34px;line-height: 34px;"></a>
    <script>
    var CURRENT_LAN = "ES";
    var CURRENT_CITY = "CI";
      _loc = {
        "EN":{
          "title_1":"Community progress",
          "title_2":"Community Preparedness",
          "paragraph_2":"Join now to get your personal scores!",
          "paragraph_3":"... and help your community become prepared",
          "join_button":"JOIN NOW",
          "lan_community_size": "Community size:",
          "lan_community_small": "Small",
          "lan_community_medium": "Medium",
          "lan_community_big": "Large",
          "lan_community_size_legend":"Increase in members since Aug 2018: ",
          "problem_awareness":"Problem<br> Awareness ",
          "know_how":"Know- <br>How",
          "ready_to_act":">Ready <br>to Act",
          "members":"Members",
          "CI":{
            "lan_title":"What you can do in the city water community:",
            "paragraph_1":"These scores show how all the members of the community are on average prepared for flooding in the following categories.",
          },
          "LE":{
            "lan_title":"What you can do in the Leicester water community:",
            "paragraph_1":"These scores show how all the members of the community are on average prepared for flooding in the following categories.",

          },
          "MI":{
            "lan_title":"What you can do in the Milton Keynes water community:",
            "paragraph_1":"These scores show how all the members of the community are on average prepared to save water in the following categories."
          },
          "SA":{
            "lan_title":"What you can do in the Sabadell water community:",
            "paragraph_1":"These scores show how all the members of the community are on average prepared to save and reuse water in the following categories."

          },
          "JE":{
            "lan_title":"What you can do in the Jerusalem water community:",
            "paragraph_1":"These scores show how all the members of the community are on average prepared to save water in the following categories."

          }
        },
        "ES":{
          "title_1":"Progreso de la comunidad",
          "title_2":"Preparación de la comunidad",
          "paragraph_2":"¡Únete ahora para obtener tus puntaciones personales!",
          "paragraph_3":"... y ayuda a tu comunidad a prepararse",
          "join_button":"ÚNETE AHORA",
          "lan_community_size": "Tamaño de la comunidad:",
          "lan_community_small": "Pequeña",
          "lan_community_medium": "Mediana",
          "lan_community_big": "Grande",
          "lan_community_size_legend":"Incremento en miembros desde Ago 2018: ",
          "problem_awareness": "Conciencia del <br>problema",
          "know_how": "Saber cómo<br>",
          "ready_to_act": "Listo para <br>actuar",
          "members":"Miembros",
          "CI":{
            "lan_title":"What you can do in the city water community:",
            "paragraph_1":"These scores show how all the members of the community are on average prepared for flooding in the following categories.",
          },
          "LE":{
            "lan_title":"What you can do in the Leicester water community:",
            "paragraph_1":"These scores show how all the members of the community are on average prepared for flooding in the following categories.",

          },
          "MI":{
            "lan_title":"What you can do in the Milton Keynes water community:",
            "paragraph_1":"These scores show how all the members of the community are on average prepared to save water in the following categories."
          },
          "SA":{
            "lan_title":"What you can do in the Sabadell water community:",
            "paragraph_1":"These scores show how all the members of the community are on average prepared to save and reuse water in the following categories."

          },
          "JE":{
            "lan_title":"What you can do in the Jerusalem water community:",
            "paragraph_1":"These scores show how all the members of the community are on average prepared to save water in the following categories."

          }
        },
        "DE":{
          "title_1":"Fortschritt der Gemeinschaft",
          "title_2":"Handlungsbereitschaft der Gemeinschaft",
          "paragraph_2":"Melden Sie sich jetzt an, um Ihre persönliche Punktezahl zu sehen!",
          "paragraph_3":"...und helfen Sie Ihrer Gemeinschaft, sich auf den Klimawandel vorzubereiten",
          "join_button":"Jetzt starten",
          "lan_community_size": "Größe der Gemeinschaft",
          "lan_community_small": "Klein",
          "lan_community_medium": "Mittelgroß",
          "lan_community_big": "Groß",
          "lan_community_size_legend":"Increase in members since Aug 2018: ",
          "problem_awareness":"Problembewusstsein",
          "know_how":"Know-how",
          "ready_to_act":"Handlungsbereitschaft",
          "members":"Mitglieder",
          "CI":{
            "lan_title":"What you can do in the city water community:",
            "paragraph_1":"These scores show how all the members of the community are on average prepared for flooding in the following categories.",
          },
          "LE":{
            "lan_title":"What you can do in the Leicester water community:",
            "paragraph_1":"These scores show how all the members of the community are on average prepared for flooding in the following categories.",

          },
          "MI":{
            "lan_title":"What you can do in the Milton Keynes water community:",
            "paragraph_1":"These scores show how all the members of the community are on average prepared to save water in the following categories."
          },
          "SA":{
            "lan_title":"What you can do in the Sabadell water community:",
            "paragraph_1":"These scores show how all the members of the community are on average prepared to save and reuse water in the following categories."

          },
          "JE":{
            "lan_title":"What you can do in the Jerusalem water community:",
            "paragraph_1":"These scores show how all the members of the community are on average prepared to save water in the following categories."
          },
          "HA":{
            "lan_title":"Was Sie in der Hanau POWER Community tun können:",
            "paragraph_1":"Dieser Punktestand zeigt, wie gut alle Mitglieder der Hanau POWER Community vorbereitet sind, sich an den Klimawandel anzupassen und das Klima zu schützen."
          }
        },
      }
      u    = new URL(window.location);
      _lan = u.searchParams.get("lan");
      _city = u.searchParams.get("city");
      if(_city != null){
        CURRENT_CITY = _city;
      }else {
        CURRENT_CITY = "CI"
      }
      if(_lan != null){
        CURRENT_LAN = _lan;
      }else {
        CURRENT_LAN = "EN"
      }
      function share(link){
        window.open(link);
      }
      function updateLinks(){
        _link1 = "https://{city}.power-h2020.eu/?location=challenge&loadP=1160";
        _link2 = "javascript:share('https://www.facebook.com/sharer/sharer.php?u=https%3A//{city}.power-h2020.eu/')  ";
        _link4 = "https://city.power-h2020.eu/?location=challenge&loadP=1121"
        _link6 = "https://{city}.power-h2020.eu/?location=home&login_pub";
        _link3 = "https://{city}.power-h2020.eu/?location=area"
        switch (CURRENT_CITY) {
          case "CI":
            _link1 = "https://city.power-h2020.eu/?location=challenges"
            _link2 = _link2.replace("{city}","city")
            _link3 = _link3.replace("{city}","city")
            _link6 = _link6.replace("{city}","city")
            break;
          case "LE":
            _link1 =  "https://leicester.power-h2020.eu/?location=challenges"
            _link2 = _link2.replace("{city}","leicester")
            _link3 = _link3.replace("{city}","leicester")
            _link6 = _link6.replace("{city}","leicester")
           _link4  =  "https://leicester.power-h2020.eu/?location=challenges"
            break;
          case "MI":
            _link1 = "https://milton-keynes.power-h2020.eu/?location=challenges"
            _link2 = _link2.replace("{city}","milton-keynes")
            _link3 = _link3.replace("{city}","milton-keynes")
            _link6 = _link6.replace("{city}","milton-keynes")
            _link4  =  "https://milton-keynes.power-h2020.eu/?location=challenge&loadP=1200"

            break;
          case "SA":
            _link1 = "https://sabadell.power-h2020.eu/?location=challenges"
            _link2 = _link2.replace("{city}","sabadell")
            _link3 = _link3.replace("{city}","sabadell")
            _link6 = _link6.replace("{city}","sabadell")
            _link4 = "https://sabadell.power-h2020.eu/?location=challenge&loadP=1220"
            break;
          case "JE":
            _link1 = "https://jerusalem.power-h2020.eu/?location=challenges"
            _link2 = _link2.replace("{city}","jerusalem")
            _link3 = _link3.replace("{city}","jerusalem")
            _link6 = _link6.replace("{city}","jerusalem")
            _link4 = "https://jerusalem.power-h2020.eu/?location=challenge&loadP=1240"
            break;
          case "HA":
          https://{city}.power-h2020.eu/?location=home&login_pub";
            _link1 = "https://hanau.baseform.com/?location=challenges";
            _link2 = "javascript:share('https://www.facebook.com/sharer/sharer.php?u=https://hanau.baseform.com/?location=home')";
            _link3 = "https://hanau.baseform.com/?location=area";
            _link6 = "https://hanau.baseform.com/?location=home&login_pub";
            _link4 = "https://hanau.baseform.com/?location=challenge&loadP=3820";
            break;
          default:

        }

          links_classes = document.getElementsByClassName("link1");
          for (var i = 0; i < links_classes.length; i++) {
            links_classes[i].setAttribute("href",_link1)
          }
          links_classes = document.getElementsByClassName("link2");
          for (var i = 0; i < links_classes.length; i++) {
            links_classes[i].setAttribute("href",_link2)
          }
          links_classes = document.getElementsByClassName("link3");
          for (var i = 0; i < links_classes.length; i++) {
            links_classes[i].setAttribute("href",_link3)
          }
          links_classes = document.getElementsByClassName("link4");
          for (var i = 0; i < links_classes.length; i++) {
            links_classes[i].setAttribute("href",_link3)
          }
          links_classes = document.getElementsByClassName("link6");
          for (var i = 0; i < links_classes.length; i++) {
            links_classes[i].setAttribute("href",_link6)
          }

      }
      function updateCity(){
        if(_lan != null){
          CURRENT_LAN = _lan;
        }

        for (k in _loc[CURRENT_LAN][CURRENT_CITY]){
            lan_classes = document.getElementsByClassName(k);
            for (var i = 0; i < lan_classes.length; i++) {
              lan_classes[i].innerHTML = _loc[CURRENT_LAN][CURRENT_CITY][k];
            }

        }
      }
      function updateLan(){
        if(_lan != null){
          CURRENT_LAN = _lan;
        }
        for (k in _loc[CURRENT_LAN]){
            lan_classes = document.getElementsByClassName(k);
            for (var i = 0; i < lan_classes.length; i++) {
              lan_classes[i].innerHTML = _loc[CURRENT_LAN][k];
            }

        }
      }
      updateCity();
      updateLan();
      updateLinks();
      // resize();
      var WIDTH = 0;
      function resize(){
        if(WIDTH != window.innerWidth){
          HEIGHT = window.innerHeight;
          WIDTH  = window.innerWidth;
          if(WIDTH < 560){
            // document.getElementsByClassName("teaser_container_mobile")[0].style.display = "block";
            // document.getElementsByClassName("teaser_container")[0].style.display = "none";
          }else{
            // document.getElementsByClassName("teaser_container_mobile")[0].style.display = "none";
            // document.getElementsByClassName("teaser_container")[0].style.display = "flex";

          }
        }

      }
      window.onload = function()
       {
         window.apiClient = new PowerApiClient(function(a){
           window.apiData = a;
           _g1 = apiClient.getGlobal().obj.gamification.personal["problem.awareness"];
           _g1 += apiClient.getGlobal().obj.gamification.political["problem.awareness"];
           _g1 += apiClient.getGlobal().obj.gamification.social["problem.awareness"];
           _g2 = apiClient.getGlobal().obj.gamification.personal["practical.knowledge"];
           _g2 += apiClient.getGlobal().obj.gamification.political["practical.knowledge"];
           _g2 += apiClient.getGlobal().obj.gamification.social["practical.knowledge"];
           _g3 = apiClient.getGlobal().obj.gamification.personal["ready.for.action"];
           _g3 += apiClient.getGlobal().obj.gamification.political["ready.for.action"];
           _g3 += apiClient.getGlobal().obj.gamification.social["ready.for.action"];
           changeProgress(_g1,_g2,_g3);
           addSize(apiClient.getGlobal().obj.participants);

         });
      }
      var circle = document.getElementById("circ_1");
      var radius = circle.r.baseVal.value;
      var circumference = radius * 2 * Math.PI;

      var circle2 = document.getElementById("circ_2");
      var radius2 = circle.r.baseVal.value;
      var circumference2 = radius2 * 2 * Math.PI;

      var circle3 = document.getElementById("circ_3");
      var radius3 = circle.r.baseVal.value;
      var circumference3 = radius3 * 2 * Math.PI;

      circle.style.strokeDasharray = `${circumference} ${circumference}`;
      circle.style.strokeDashoffset = `${circumference}`;
      circle2.style.strokeDasharray = `${circumference} ${circumference}`;
      circle2.style.strokeDashoffset = `${circumference}`;
      circle3.style.strokeDasharray = `${circumference} ${circumference}`;
      circle3.style.strokeDashoffset = `${circumference}`;
      function setProgress(percent) {
        const offset = circumference - percent / 100 * circumference;
        circle.style.strokeDashoffset = offset;
      }
      const input = document.getElementById('input1');
      function setProgress2(percent) {
        const offset2 = circumference2 - percent / 100 * circumference2;
        circle2.style.strokeDashoffset = offset2;
      }
      const input2 = document.getElementById('input2');
      function setProgress3(percent) {
        const offset3 = circumference3 - percent / 100 * circumference3;
        circle3.style.strokeDashoffset = offset3;
      }

      const input3 = document.getElementById('input3');
      function changeProgress(la,lb,lc){
          _MAX_POINTS_LEVEL = 3000;
          setPAPoints(la);
          setKHPoints(lb);
          setRAPoints(lc);
          if(la > _MAX_POINTS_LEVEL){
            la = _MAX_POINTS_LEVEL
          }
          if(lb > _MAX_POINTS_LEVEL){
            lb = _MAX_POINTS_LEVEL
          }
          if(lc > _MAX_POINTS_LEVEL){
            lc = _MAX_POINTS_LEVEL
          }

          lra = ( la / _MAX_POINTS_LEVEL )*100 ;
          lrb = ( lb / _MAX_POINTS_LEVEL )*100 ;
          lrc = ( lc / _MAX_POINTS_LEVEL )*100 ;

          setProgress(lra);
          setProgress2(lrb);
          setProgress3(lrc);


      }
      function setPAPoints(p){
        document.getElementById("pa_points").innerHTML = numberWithCommas(Math.round(p));
      }
      function setKHPoints(p){
        document.getElementById("kh_points").innerHTML = numberWithCommas(Math.round(p));
      }
      function setRAPoints(p){
        document.getElementById("ra_points").innerHTML = numberWithCommas(Math.round(p));
      }
      const numberWithCommas = (x) => {
        return x.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
      }
      function addSize(size){
        var canvas = document.getElementById("canvas");
        var ctx = canvas.getContext("2d");
        var sizeWidth = ctx.canvas.clientWidth;
        var sizeHeight = ctx.canvas.clientHeight;
        var scaleWidth = sizeWidth/100;
        var scaleHeight = sizeHeight/100;

        marginRight = 10;
        ctx.font = "13px Arial";
        ctx.beginPath();
        ctx.lineWidth   = 2;
        ctx.strokeStyle = '#848177';
        ctx.moveTo(0,0);
        ctx.fillStyle   = "#848177";
        if(size <= 20){
          _size  = _loc[CURRENT_LAN].lan_community_small;
        }else if((size >= 20) && (size <= 50)){
          _size  = _loc[CURRENT_LAN].lan_community_medium;
        }else{
          _size  = _loc[CURRENT_LAN].lan_community_big;
        }
        ctx.strokeStyle = '#265380';
        ctx.fillStyle   = "#09244c";
        ctx.font = "bold 16px Arial";

        _max_pop = 2000;
        _aug = 0;
        if( CURRENT_CITY  == "LE" ){
          _max_pop = 3000;
          _aug = 60;

        }else if (CURRENT_CITY  == "MI"){
          _aug = 55;
        }else if (CURRENT_CITY  == "SA"){
          _aug = 39;
        }else if (CURRENT_CITY  == "JE"){
          _aug = 57;
        }else if (CURRENT_CITY == "CI"){
          _aug = 1;
        }
        _inc = (size - _aug);
        _inc = (_inc / _aug) * 100;
        if(CURRENT_CITY !== "HA"){
          _barSize = (sizeWidth - 100);
          _barY1   = 20;
          _barY2   = _barY1 + 20;
          _l1      = (_barSize / 2 );
          _l2      = (_barSize / 4 );
          ctx.textAlign   = "left";
          ctx.fillText(_loc[CURRENT_LAN].lan_community_size,0 ,15);
          ctx.textAlign   = "center";
          ctx.fillText("5%",_l1/5 ,60);
          ctx.fillText("25%",_l2 ,60);
          ctx.fillText("50%",_l1 ,60);
          ctx.textAlign   = "start";
          ctx.fillText(_max_pop,_barSize ,35);

          _increaseLeyend = _loc[CURRENT_LAN].lan_community_size_legend + numberWithCommas((_inc).toFixed(0)) + "%";
          ctx.fillText(_increaseLeyend,0,80);

          ctx.stroke();
          _fillBarcolor = "#4382b5";
          ctx.fillStyle   = _fillBarcolor;

          _barWidth = _barSize ;
          // fill
          ctx.beginPath();
          _MAX_SIZE = 2000;
          if(size >= _MAX_SIZE){
            size  = _MAX_SIZE
          }
          if(size <= 100){
            _sP = (size  * .33) / 100
          }else if(size > 100 && size <=1000){
            _sP =  (size/1000) * .66
            console.log(_sP);
          }else if(size >1001){
            _sP =  (size/2000) * 1;
          }
          ctx.fillRect(0,_barY1,_barWidth * _sP ,20);
          ctx.closePath();
          ctx.fillStyle   = "#09244c";

          //left
          ctx.beginPath();
          ctx.moveTo(0,_barY1);
          ctx.lineTo(0,_barY2);
          ctx.closePath();
          ctx.stroke();
          //top
          ctx.beginPath();
          ctx.moveTo(0,_barY1);
          ctx.lineTo(_barSize - marginRight,_barY1);
          ctx.closePath();
          ctx.stroke();
          //bottom
          ctx.beginPath();
          ctx.moveTo(0,_barY2);
          ctx.lineTo(_barSize - marginRight,_barY2);
          ctx.closePath();
          ctx.stroke();
          //right
          ctx.beginPath();
          ctx.moveTo(_barSize - marginRight,_barY1);
          ctx.lineTo(_barSize - marginRight,_barY2);
          ctx.closePath();
          ctx.stroke();
          //l0
          ctx.beginPath();
          ctx.moveTo(_l1/5,_barY1 + 15);
          ctx.lineTo(_l1/5,_barY1 + 25);
          ctx.closePath();
          ctx.stroke();
          //l1
          ctx.beginPath();
          ctx.moveTo(_l1,_barY1 + 15);
          ctx.lineTo(_l1,_barY1 + 25);
          ctx.closePath();
          ctx.stroke();
          //l2
          ctx.beginPath();
          ctx.moveTo(_l2,_barY1 + 15);
          ctx.lineTo(_l2,_barY1 + 25);
          ctx.closePath();
          ctx.stroke();
        }

      }
    </script>

  </body>
</html>
