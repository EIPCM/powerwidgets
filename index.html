<html>
<div class="powerPopup">
  <div class="powerPopupContent">
    <div  class="powerCloseButtonWrapper" onclick="hidePowerPopup();">
      <img src="img/cancel.png" width="32" height="32"></img>
    </div>
    <div  id="powerPopupContent">
    </div>

  </div>
</div>
  <head>
   <link rel="stylesheet" type="text/css" href="css/powerwidgets.css">
   <link href="https://fonts.googleapis.com/css?family=Montserrat" rel="stylesheet">
   <link href="https://fonts.googleapis.com/css?family=Fredoka+One" rel="stylesheet">
   <link href="css/switchery.css" rel="stylesheet">
   <script type="text/javascript" src="js/switchery.js"></script>

   <script type="text/javascript" src="//city.power-h2020.eu/redesign_js/client.js"></script> <!-- need to include this script to talk with the api -->
  </head>

  <body  onresize="resize()">

    <div class="indicators">
      <div class="indicator indicatora">
        <div class="powerMessage">
          <span style="display:flex;flex-direction:row;" >
            <span style="font-size:1.5em !important;padding-left: 10px;">Total Points: <span id="total_score"></span></span>
            <span style="display: flex;flex-direction: row;justify-content: space-between;flex: .8;" id="links">

            </span>
          </span>
        </div>
        <!-- <div class="arrow-down" onclick="toggleHideableArea(this)" data="1"></div> -->
        <div class="powerTitle" id="preparedness">Personal Preparedness <img src="img/information.png" height="22" width="22" class="infoButton" onclick="m1()"></img></div>
        <div class="hideable-area">
          <div class="toggleWrapper">
            <input type="checkbox" class="js-switch" checked />
            <div style="font-family: 'Fredoka One', cursive;">Show Levels</div>
            <img src="img/information.png" height="22" width="22" class="infoButton" onclick="m2()"></img>
          </div>
          <div class="circularWrapper">
            <div class="svgWrapper">
              <div class="circularTitle">Problem<br> Awareness</div>
              <svg
                 class="progress-ring"
                 width="140"
                 fill="#13377f"
                 height="140"
                 shape-rendering="geometricPrecision"
                 >
                <circle
                  id="circ_1"
                  class="progress-ring__circle"
                  transform="rotate(-90 0 0)"
                  stroke="#6d0949"
                  stroke-width="50"
                  fill="#13377f"
                  r="30"
                  cx="70"
                  cy="70"/>
                <circle
                  stroke="white"
                  stroke-width="2"
                  fill="#6d0949"
                  r="30"
                  cx="70"
                  cy="70"/>
                <circle
                  stroke="#6d0949"
                  stroke-width="2"
                  fill="transparent"
                  r="57"
                  cx="70"
                  cy="70"/>
                <line x1="0" y1="70" x2="140" y2="70" style="stroke:rgb(109,9,73);stroke-width:2"/>
                <line x1="70" y1="0" x2="70" y2="140" style="stroke:rgb(109,9,73);stroke-width:2"/>

                <image xlink:href="img/prob_awe.png" height="140" width="140"  rx="15" ry="15" />

              </svg>
              <div class="circularLevelsWrapper" id="circularLevels1">
                <img src="img/circ_talk_gray.png" class="iconsmall"/>
                <img src="img/circ_talk_gray.png" class="iconsmall"/>
                <img src="img/circ_talk_gray.png" class="iconsmall"/>
              </div>


            </div>
            <div class="svgWrapper">
              <div class="circularTitle">Know- <br>How</div>

              <svg
                 class="progress-ring"
                 width="140"
                 fill="#13377f"
                 height="140"
                 shape-rendering="geometricPrecision"
                 >
                <circle
                  class="progress-ring__circle"
                  transform="rotate(-90 0 0)"
                  stroke="#13377f"
                  stroke-width="50"
                  fill="#13377f"
                  r="30"
                  cx="70"
                  cy="70"
                  id="circ_2"
                  />
                <circle
                  stroke="white"
                  stroke-width="2"
                  fill="#13377f"
                  r="30"
                  cx="70"
                  cy="70"/>
                <circle
                  stroke="#13377f"
                  stroke-width="2"
                  fill="transparent"
                  r="57"
                  cx="70"
                  cy="70"/>
                  <line x1="0" y1="70" x2="140" y2="70" style="stroke:rgb(19,55,127);stroke-width:2"/>
                  <line x1="70" y1="0" x2="70" y2="140" style="stroke:rgb(19,55,127);stroke-width:2"/>
                <image xlink:href="img/idea.png" height="140" width="140"  rx="15" ry="15" />
              </svg>
              <div class="circularLevelsWrapper"  id="circularLevels2">
                <img src="img/circ_idea_gray.png" class="iconsmall"/>
                <img src="img/circ_idea_gray.png" class="iconsmall"/>
                <img src="img/circ_idea_gray.png" class="iconsmall"/>
              </div>
            </div>

            <div class="svgWrapper">
              <div class="circularTitle">Ready <br>to Act</div>

              <svg
                 class="progress-ring"
                 width="140"
                 fill="#493f8d"
                 height="140"
                 shape-rendering="geometricPrecision"
                 >
                <circle
                  class="progress-ring__circle"
                  transform="rotate(-90 0 0)"
                  stroke="#493f8d"
                  stroke-width="50"
                  fill="#493f8d"
                  r="30"
                  cx="70"
                  cy="70"
                  id="circ_3"
                  />
                <circle
                  stroke="white"
                  stroke-width="2"
                  fill="#493f8d"
                  r="30"
                  cx="70"
                  cy="70"/>
                <circle
                  stroke="#493f8d"
                  stroke-width="2"
                  fill="transparent"
                  r="57"
                  cx="70"
                  cy="70"/>
                  <line x1="0" y1="70" x2="140" y2="70" style="stroke:rgb(73,63,141);stroke-width:2"/>
                  <line x1="70" y1="0" x2="70" y2="140" style="stroke:rgb(73,63,141);stroke-width:2"/>
                <image xlink:href="img/ready_act.png" height="140" width="140"  rx="15" ry="15" />
              </svg>
              <div class="circularLevelsWrapper" id="circularLevels3">
                <img src="img/circ_stopwatch_gray.png" class="iconsmall"/>
                <img src="img/circ_stopwatch_gray.png" class="iconsmall"/>
                <img src="img/circ_stopwatch_gray.png" class="iconsmall"/>
              </div>
            </div>
        </div>
      </div>


    </div>
    <div class="powerMessage" id="impact">&nbsp;</div>

      <div class="indicator indicatorb">
        <!-- <div class="arrow-down" onclick="toggleHideableArea(this)"></div> -->

        <div class="powerTitle">Personal Impact <img src="img/information.png" height="22" width="22" class="infoButton" onclick="m6()"></img></div>
        <div class="hideable-area" style="padding-bottom: 20px;">
          <div class="toggleWrapper">
            <input type="checkbox" class="js-switch" checked />
            <div style="font-family: 'Fredoka One', cursive;">Show Levels</div>
            <img src="img/information.png" height="22" width="22" class="infoButton" onclick="m2()"></img>
          </div>
        <div class="powerRow">
          <div class="powerBartitle">Political</div><div class="powerBarWrapper">
            <div class="powerBarLevelsWrapper" id="powerBarLevels1">
              <img src="img/political.png" class="iconsmall"/>
              <img src="img/political.png" class="iconsmall"/>
              <img src="img/political_gray.png" class="iconsmall"/>
            </div>
            <div class="iconWrapper political">
              <img src="img/political.png" class="icon political"/>
            </div>
            <div class="pwrapper">
              <div class="powerBar political">
                <div class="powerScaleWrapper" style="">
                  <div class="powerScale political">
                  </div>
                  <div class="powerScale political">
                  </div>
                  <div class="powerScale political">
                  </div>
                  <div class="powerScale political">
                  </div>
                  <div class="powerScale political">
                  </div>
                  <div class="powerScale political">
                  </div>
                  <div class="powerScale political">
                  </div>
                  <div class="powerScale political">
                  </div>
                  <div class="powerScale political">
                  </div>
                  <div class="powerScale political">
                  </div>
                </div>

                <div class="fill political" style="width: 50%;" id="powerBar1"></div>
              </div>
            </div>
          </div>
        </div>
        <div class="powerRow">
          <div class="powerBartitle">Social</div><div class="powerBarWrapper">
            <div class="powerBarLevelsWrapper"  id="powerBarLevels2">
              <img src="img/users-group.png" class="iconsmall"/>
              <img src="img/users-group.png" class="iconsmall"/>
              <img src="img/users-group_gray.png" class="iconsmall"/>
            </div>
            <div class="iconWrapper social">
              <img src="img/users-group.png" class="icon political"/>
            </div>
            <div class="pwrapper">
              <div class="powerScaleWrapper" style="">
                <div class="powerScale social">
                </div>
                <div class="powerScale social">
                </div>
                <div class="powerScale social">
                </div>
                <div class="powerScale social">
                </div>
                <div class="powerScale social">
                </div>
                <div class="powerScale social">
                </div>
                <div class="powerScale social">
                </div>
                <div class="powerScale social">
                </div>
                <div class="powerScale social">
                </div>
                <div class="powerScale social">
                </div>
              </div>
              <div class="powerBar social">
                <div class="fill social" style="width: 50%;" id="powerBar2"></div>
              </div>
            </div>
          </div>
        </div>
        <div class="powerRow">
        <div class="powerBartitle">Individual</div><div class="powerBarWrapper">
          <div class="powerBarLevelsWrapper"  id="powerBarLevels3">
            <img src="img/people.png" class="iconsmall"/>
            <img src="img/people.png" class="iconsmall"/>
            <img src="img/people_gray.png" class="iconsmall"/>
          </div>
            <div class="iconWrapper individual">
              <img src="img/people.png" class="icon political"/>
            </div>
            <div class="pwrapper">
              <div class="powerBar individual">
                <div class="powerScaleWrapper" style="">
                  <div class="powerScale individual">
                  </div>
                  <div class="powerScale individual">
                  </div>
                  <div class="powerScale individual">
                  </div>
                  <div class="powerScale individual">
                  </div>
                  <div class="powerScale individual">
                  </div>
                  <div class="powerScale individual">
                  </div>
                  <div class="powerScale individual">
                  </div>
                  <div class="powerScale individual">
                  </div>
                  <div class="powerScale individual">
                  </div>
                  <div class="powerScale individual">
                  </div>
                </div>
                <div class="fill individual" style="width: 100%;" id="powerBar3"></div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="powerMessage" id="achievement">Become better prepared for flooding by increasing your impact and preparedness!</div>
    </div>

    <div class="indicator indicatorc">
      <!-- <div class="arrow-down" onclick="toggleHideableArea(this)"></div> -->
      <div class="powerTitle">Flood Warden Achievement <img src="img/information.png" height="22" width="22" class="infoButton" onclick="m5()"></img></div>
      <div class="hideable-area">
          <div class="powerContent" style="width:100%">
            <div class="warden">
            <div id="warden_bar_0">
              <div id="warden_bar0_fill"  style="width:0%"></div>
            </div>
            <div class="badge"   id="badge1" >
              <img src="img/badge1.png" id="badge_img1"/>
              <div class="level_lbl"><b>Beginner</b> 1000</div>
            </div>
            <div id="warden_bar_1">
              <div id="warden_bar1_fill"  style="width:0%"></div>
            </div>
            <div class="badge " id="badge2">
              <img src="img/badge2.png" id="badge_img2"/>
              <div class="level_lbl"><b>Intermediate</b> 4000</div>
            </div>
            <div id="warden_bar_2">
              <div id="warden_bar2_fill" style="width:0%"></div>
            </div>
            <div class="badge " id="badge3">
              <img src="img/badge3.png" id="badge_img3"/>
              <div class="level_lbl"><b>Advanced</b> 10000</div>
            </div>
          </div>
          </div>
      </div>
    </div>
    <div class="powerMessage" id="community">Try hard to become advanced flood warden!</div>
    <div class="indicator indicatorc">
      <!-- <div class="arrow-down" onclick="toggleHideableArea(this)"></div> -->
      <div class="powerTitle">Boost Factor<img src="img/information.png" height="22" width="22" class="infoButton" onclick="m3()"></img></div>
      <div class="hideable-area">
        <div class="powerContent" style="width:100%">
            <div class="boost_factor_wrapper">
              <div class="boost_factor 1">1.5x</div>
              <div class="boost_factor 2">2x</div>
              <div class="boost_factor 3">3x</div>
            </div>
        </div>
      </div>
    </div>
    <div class="powerMessage" id="community">&nbsp;</div>
    <div class="indicator indicatord">
      <div class="powerTitle">Community Preparedness <img src="img/information.png" height="22" width="22" class="infoButton" onclick="m4()"></img></div>
      <!-- <div class="arrow-down" onclick="toggleHideableArea(this)"></div> -->
      <div class="hideable-area">
      <div class="toggleWrapper">

      </div>
      <div class="toggleWrapper">
        <input type="checkbox" class="js-switch" checked  id="check_personal"/>
        <div style="font-family: 'Fredoka One', cursive;">Show Personal</div>
      </div>

      <div style="margin-left:auto;margin-right:auto;height:500px">
        <canvas id="spider" height="500" width="750" style="z-index:1"></canvas>
        <div class="powerMessage" id="impact">Help the community become equally prepared for flooding in all the categories.</div>

      </div>
      </div>
    </div>

  </div>
  </div>
  </body>
<script>
var circle = document.getElementById("circ_1");
var radius = circle.r.baseVal.value;
var circumference = radius * 2 * Math.PI;

var circle2 = document.getElementById("circ_2");
var radius2 = circle.r.baseVal.value;
var circumference2 = radius2 * 2 * Math.PI;

var circle3 = document.getElementById("circ_3");
var radius3 = circle.r.baseVal.value;
var circumference3 = radius3 * 2 * Math.PI;

circle.style.strokeDasharray = `${circumference} ${circumference}`;
circle.style.strokeDashoffset = `${circumference}`;
circle2.style.strokeDasharray = `${circumference} ${circumference}`;
circle2.style.strokeDashoffset = `${circumference}`;
circle3.style.strokeDasharray = `${circumference} ${circumference}`;
circle3.style.strokeDashoffset = `${circumference}`;


function setProgress(percent) {
  const offset = circumference - percent / 100 * circumference;
  circle.style.strokeDashoffset = offset;
}

const input = document.getElementById('input1');
/*setProgress(input.value);

input.addEventListener('change', function(e) {
  if (input.value < 101 && input.value > -1) {
    setProgress(input.value);
  }
})*/
// 2




function setProgress2(percent) {
  const offset2 = circumference2 - percent / 100 * circumference2;
  circle2.style.strokeDashoffset = offset2;
}

const input2 = document.getElementById('input2');
/*setProgress2(input2.value);

input2.addEventListener('change', function(e) {
  if (input2.value < 101 && input2.value > -1) {
    setProgress2(input2.value);
  }
})*/

// 3


function setProgress3(percent) {
  const offset3 = circumference3 - percent / 100 * circumference3;
  circle3.style.strokeDashoffset = offset3;
}

const input3 = document.getElementById('input3');
/*setProgress3(input3.value);

input3.addEventListener('change', function(e) {
  if (input3.value < 101 && input3.value > -1) {
    setProgress3(input3.value);
  }
})*/
function changeProgress(la,lb,lc){
  var _MAX_POINTS_LEVEL = 2000;
  lra = la - (Math.floor( la / _MAX_POINTS_LEVEL) * _MAX_POINTS_LEVEL) ;
  lrb = lb - (Math.floor( lb / _MAX_POINTS_LEVEL) * _MAX_POINTS_LEVEL) ;
  lrc = lc - (Math.floor( lc / _MAX_POINTS_LEVEL) * _MAX_POINTS_LEVEL) ;

  _p1 = lra * 100 / _MAX_POINTS_LEVEL;
  _p2 = lrb * 100 / _MAX_POINTS_LEVEL;
  _p3 = lrc * 100 / _MAX_POINTS_LEVEL;
  setProgress(_p1);
  setProgress2(_p2);
  setProgress3(_p3);

  addCircularLevelsPA(_p1);
  addCircularLevelsKH(_p2);
  addCircularLevelsRA(_p3);

}
function addCircularLevelsPA(l){
  _earned  = '<img src="img/circ_talk.png" class="iconsmall"/>'
  _nearned ='<img src="img/circ_talk_gray.png" class="iconsmall"/>'
  if(l >= 6000){
    _badges = _earned  + _earned + _earned;
  }else if( (l <= 5999) && (l >= 4000) ){
    _badges = _earned  + _earned + _nearned;
  }else if( (l <= 3999) && (l >= 2000) ){
    _badges = _earned  + _nearned + _nearned;
  }else{
    _badges = _nearned  + _nearned + _nearned;
  }
  document.getElementById("circularLevels1").innerHTML = _badges

}
function addCircularLevelsKH(l){
  _earned  = '<img src="img/circ_idea.png" class="iconsmall"/>'
  _nearned ='<img src="img/circ_idea_gray.png" class="iconsmall"/>'
  if(l >= 6000){
    _badges = _earned  + _earned + _earned;
  }else if( (l <= 5999) && (l >= 4000) ){
    _badges = _earned  + _earned + _nearned;
  }else if( (l <= 3999) && (l >= 2000) ){
    _badges = _earned  + _nearned + _nearned;
  }else{
    _badges = _nearned  + _nearned + _nearned;
  }
  document.getElementById("circularLevels2").innerHTML = _badges
}
function addCircularLevelsRA(l){
  _earned  = '<img src="img/circ_stopwatch.png" class="iconsmall"/>'
  _nearned ='<img src="img/circ_stopwatch_gray.png" class="iconsmall"/>'
  if(l >= 6000){
    _badges = _earned  + _earned + _earned;
  }else if( (l <= 5999) && (l >= 4000) ){
    _badges = _earned  + _earned + _nearned;
  }else if( (l <= 3999) && (l >= 2000) ){
    _badges = _earned  + _nearned + _nearned;
  }else{
    _badges = _nearned  + _nearned + _nearned;
  }
  document.getElementById("circularLevels3").innerHTML = _badges
}
// setTimeout(function(){ changeProgress() }, 1000);
function setProgressPowerBar(p,n){
  _MAX_POINTS_LEVEL = 2000;
  lrp = p - (Math.floor( p / _MAX_POINTS_LEVEL) * _MAX_POINTS_LEVEL) ;
  p = lrp * 100 / _MAX_POINTS_LEVEL;

  _pbar = document.getElementById("powerBar"+n);
  _pbar.style.width = p + "%";
}
function addPowerBarLevelsPA(l){
  _earned  = '<img src="img/political.png" class="iconsmall"/>'
  _nearned ='<img src="img/political_gray.png" class="iconsmall"/>'
  if(l >= 6000){
    _badges = _earned  + _earned + _earned;
  }else if( (l <= 5999) && (l >= 4000) ){
    _badges = _earned  + _earned + _nearned;
  }else if( (l <= 3999) && (l >= 2000) ){
    _badges = _earned  + _nearned + _nearned;
  }else{
    _badges = _nearned  + _nearned + _nearned;
  }
  document.getElementById("powerBarLevels1").innerHTML = _badges
}
function addPowerBarLevelsSO(l){
  _earned  = '<img src="img/users-group.png" class="iconsmall"/>'
  _nearned ='<img src="img/users-group_gray.png" class="iconsmall"/>'
  if(l >= 6000){
    _badges = _earned  + _earned + _earned;
  }else if( (l <= 5999) && (l >= 4000) ){
    _badges = _earned  + _earned + _nearned;
  }else if( (l <= 3999) && (l >= 2000) ){
    _badges = _earned  + _nearned + _nearned;
  }else{
    _badges = _nearned  + _nearned + _nearned;
  }
  document.getElementById("powerBarLevels2").innerHTML = _badges
}
function addPowerBarLevelsIN(l){
  _earned  = '<img src="img/people.png" class="iconsmall"/>'
  _nearned ='<img src="img/people_gray.png" class="iconsmall"/>'
  if(l >= 6000){
    _badges = _earned  + _earned + _earned;
  }else if( (l <= 5999) && (l >= 4000) ){
    _badges = _earned  + _earned + _nearned;
  }else if( (l <= 3999) && (l >= 2000) ){
    _badges = _earned  + _nearned + _nearned;
  }else{
    _badges = _nearned  + _nearned + _nearned;
  }
  document.getElementById("powerBarLevels3").innerHTML = _badges
}
function setWardenProgress(n){

  var WARDEN_LVL_0 =  1000;
  var WARDEN_LVL_1 =  4000;
  var WARDEN_LVL_2 = 10000;

  _w1 = n * 100 / WARDEN_LVL_0;
  _w2 = (n - WARDEN_LVL_0) * 100 / (WARDEN_LVL_1 - WARDEN_LVL_0);
  _w3 = (n - WARDEN_LVL_1) * 100 / (WARDEN_LVL_2 - WARDEN_LVL_1);
  // set bar fills
  document.getElementById("warden_bar0_fill").style.width = _w1 + "%"
  document.getElementById("warden_bar1_fill").style.width = _w2 + "%"
  document.getElementById("warden_bar2_fill").style.width = _w3 + "%"

  // set badges
  document.getElementById("badge1").classList.remove("earned")
  document.getElementById("badge2").classList.remove("earned")
  document.getElementById("badge3").classList.remove("earned")
  if(n >= WARDEN_LVL_0){
    document.getElementById("badge1").classList.add("earned")
    document.getElementById("badge_img1").src = "img/badge1_earned.png";
    document.getElementsByClassName("boost_factor 1")[0].style.backgroundImage = "url('img/cert_earned.png')";
  }
  if(n >= WARDEN_LVL_1){
    document.getElementById("badge_img2").src = "img/badge2_earned.png";
    document.getElementById("badge2").classList.add("earned")
    document.getElementsByClassName("boost_factor 2")[0].style.backgroundImage = "url('img/cert_earned.png')";

  }
  if(n >= WARDEN_LVL_2){
    document.getElementById("badge_img3").src = "img/badge3_earned.png";
    document.getElementById("badge3").classList.add("earned")
    document.getElementsByClassName("boost_factor 3")[0].style.backgroundImage = "url('img/cert_earned.png')";

  }


  // if(p < 100){
  //   // set only level 1, disable all the rest
  //   document.getElementById("warden_bar1_fill").style.width = p + "%"
  //   document.getElementById("warden_bar2_fill").style.width = "0%"
  //   document.getElementById("badge2").classList.remove("earned")
  //   document.getElementById("badge3").classList.remove("earned")
  //   document.getElementById("badge_img2").src = "img/badge2.png";
  //   document.getElementById("badge_img3").src = "img/badge3.png";
  //
  // }else{
  //   document.getElementById("warden_bar1_fill").style.width = "100%"
  //   document.getElementById("warden_bar2_fill").style.width = (Math.abs(100 - p) + "%");
  //   document.getElementById("badge2").classList.add("earned")
  //   document.getElementById("badge_img2").src = "img/badge2_earned.png";
  //   document.getElementById("badge_img3").src = "img/badge3.png";
  //   document.getElementById("badge3").classList.remove("earned")
  //
  //
  //   if(p >= 200){
  //     document.getElementById("badge3").classList.add("earned")
  //     document.getElementById("badge_img3").src = "img/badge3_earned.png";
  //   }
  // }
}
function initSpider(){
  var canvas = document.getElementById("spider");
  var ctx = canvas.getContext("2d");
  c = canvas.height * .50;
  canvas.width = canvas.parentElement.offsetWidth;
  canvas.height = canvas.parentElement.offsetHeight;
  var sizeWidth = ctx.canvas.clientWidth;
  var sizeHeight = ctx.canvas.clientHeight;
  var scaleWidth = sizeWidth/100;
  var scaleHeight = sizeHeight/100;
  centerX = sizeWidth/2;
  centerY = sizeHeight/2;
  r = sizeWidth *.30;
  if(sizeWidth >= sizeHeight){
    r = sizeHeight *.30;
  }
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  ctx.beginPath();
  // console.log(sizeWidth/2);
  // console.log(sizeHeight/2);
  ctx.beginPath();
  ctx.arc(centerX,centerY,1,0,2*Math.PI)
  ctx.strokeStyle = '#d7dadd';
  _goals  = [0,3,6]
  // draw 10 lines, all with the same distance between each other
  for (var i = 0; i < 11; i++) {
    ctx.lineWidth   = 1;
    ctx.strokeStyle = '#d7dadd';
    ctx.beginPath();
    ctx.arc(centerX,centerY, r - ( i *  r / 10 ) ,0,2*Math.PI)
    ctx.stroke();


  }

  _degrees = [0,40,80,120,160,200,240,280,320];
  _labels  = ["Ready to act","Awareness","Know-how","Ready to act","Awareness","Know-how","Ready to act","Awareness","Know-how",]
  _categories = ["Social","Social","Social","Political","Political","Political","Individual","Individual","Individual"]
  _categoriesIndexes = [1,4,7]
  _offset = 10; //All lines will be turned with this offset.
  _extraRadius = 20;
  ctx.lineWidth   = 1;
  _labelColors = ["#2dc463","#e23d3d","#1786e0"]

  _degrees.forEach(function(d,i){
    ctx.beginPath();
    ctx.moveTo(centerX ,centerY);
    // convert angles to radians. Add offset
    rx = (d + _offset)  * (Math.PI /180);
    ry = (d + _offset) * (Math.PI /180);
    x = centerX + (r * 1.1) * Math.cos(rx);
    y = centerY + (r * 1.1) * Math.sin(ry);
    ctx.lineTo(x,y);
    if(sizeWidth <  620){
      ctx.font = "10px Arial";

    }else{
      ctx.font = "11px Arial";

    }
    rx = (d + _offset)  * (Math.PI /180);
    ry = (d + _offset) * (Math.PI /180);
    x = centerX + r*1.17  * Math.cos(rx);
    y = centerY + r*1.17 * Math.sin(ry);

    if(i < 2 ){
      ctx.fillStyle = _labelColors[0];
    }else if(i > 2 && i < 5){
      ctx.fillStyle = _labelColors[1];
    }else if(i > 5){
      ctx.fillStyle = _labelColors[2];
    }else if(i >= _degrees.length -1){
      ctx.fillStyle = _labelColors[0];
    }
    switch (i) {
      case 0:
      case 1:
      case 8:
        ctx.textAlign="left";
      break;
      case 2:
      case 6:
      case 7:
          ctx.textAlign="center";
      break;
      case 3:
      case 4:
      case 5:
        ctx.textAlign="right";
      break;
      default:
        ctx.textAlign="center";

    }

    ctx.fillText(_labels[i],x,y);
    ctx.stroke();
    ctx.closePath();

    if(_categoriesIndexes.includes(i) && sizeWidth > 620  ){

      rx = (d + _offset)  * (Math.PI /180);
      ry = (d + _offset) * (Math.PI /180);
      x = centerX +r*1.6 * Math.cos(rx);
      y = centerY +r*1.6 * Math.sin(ry);
      ctx.font = "20px Arial";
      ctx.beginPath();
      switch (i) {
        case 1:
        ctx.textAlign="left";
        break;
        case 4:
        x = centerX +r*1.8 * Math.cos(rx);
        y = centerY +r*1.8 * Math.sin(ry);
        ctx.textAlign="right";
        break;
        case 7:
        x = centerX +r*1.4 * Math.cos(rx);
        y = centerY +r*1.4 * Math.sin(ry);
        ctx.textAlign="left";
        break;
        default:

      }
      // ctx.fillText(_categories[i],x,y);
      ctx.stroke();
      ctx.closePath();
    }
    ctx.font = "12px Arial";


  });


  ctx.closePath();

}
function addSize(size){
  var canvas = document.getElementById("spider");
  var ctx = canvas.getContext("2d");
  var sizeWidth = ctx.canvas.clientWidth;
  var sizeHeight = ctx.canvas.clientHeight;
  var scaleWidth = sizeWidth/100;
  var scaleHeight = sizeHeight/100;

  marginRight = 10;
  ctx.font = "13px Arial";
  ctx.beginPath();
  ctx.lineWidth   = 2;
  ctx.strokeStyle = '#848177';
  ctx.moveTo(0,0);
  ctx.fillStyle   = "#848177";
  if(size <= 20){
    _size  = "Small";
  }else if((size >= 20) && (size <= 50)){
    _size = "Medium";
  }else{
    _size = "Large";
  }
  ctx.strokeStyle = '#000000';
  ctx.fillStyle   = "#000000";
  ctx.textAlign   = "right";
  ctx.font = "bold 16px Arial";
  ctx.fillText("Community Size",sizeWidth - marginRight ,50);
  ctx.fillText(_size,sizeWidth - marginRight,75);
  ctx.stroke();
}
function addImpact(){
  marginLeft = 10;
  var canvas = document.getElementById("spider");
  var ctx = canvas.getContext("2d");
  var sizeWidth = ctx.canvas.clientWidth;
  var sizeHeight = ctx.canvas.clientHeight;
  var scaleWidth = sizeWidth/100;
  var scaleHeight = sizeHeight/100;
  _labelColors = ["#2dc463","#e23d3d","#1786e0"]
  if(sizeWidth <  620){
    ctx.font = "bold 13px Arial";
  }else{
    ctx.font = "bold 16px Arial";


  }

  ctx.beginPath();
  ctx.lineWidth   = 2;
  ctx.fillStyle = 'black';
  ctx.textAlign   = "left";
  ctx.fillText("Impact",marginLeft + 20,sizeHeight - 125);
  ctx.fillText("Individual",marginLeft + 20,sizeHeight - 100);
  ctx.fillText("Social",marginLeft + 20,sizeHeight - 75);
  ctx.fillText("Political",marginLeft + 20,sizeHeight - 50);
  ctx.closePath();

  ctx.beginPath();
  ctx.fillStyle   = _labelColors[0];
  ctx.arc( marginLeft + 10,sizeHeight - 105,4,0,2*Math.PI)
  ctx.fill();
  ctx.closePath();

  ctx.beginPath();
  ctx.fillStyle   = _labelColors[1];
  ctx.arc( marginLeft + 10,sizeHeight - 80,4,0,2*Math.PI)
  ctx.fill();
  ctx.closePath();

  ctx.beginPath();
  ctx.fillStyle   = _labelColors[2];
  ctx.arc( marginLeft + 10,sizeHeight - 55,4,0,2*Math.PI)
  ctx.fill();
  ctx.closePath();




}
function addGoals(){
  _degrees = [0,20,30,60,160,200,240,280,320,360];
  _offset = 10; //All lines will be turned with this offset.
  var canvas = document.getElementById("spider");
  var ctx = canvas.getContext("2d");
  var sizeWidth = ctx.canvas.clientWidth;
  var sizeHeight = ctx.canvas.clientHeight;
  var scaleWidth = sizeWidth/100;
  var scaleHeight = sizeHeight/100;
  values = [4,7,10]
  if(sizeWidth <  620){
    _labels = ["Very well prepared", "Quite prepared","A bit prepard"]
    _marginRightA = 30;
    _marginRightB = 30;
    _marginRightC = 25;
    ctx.font = "11px Arial";

  }else{
    _labels = ["Very well prepared", "Quite prepared","A bit prepared"]

    _marginRightA = 45;
    _marginRightB = 110;
    _marginRightC = 110;
    ctx.font = "13px Arial";

  }

  values.forEach(function(v,i){
    vi = Math.abs(v - _degrees.length);
    _rd  = r - ( vi  *  r / 10 ) //radius distance
    // convert angles to radians. Add offset
    // convert angles to radians. Add offset
    rx = (_degrees[0+i] + _offset)  * (Math.PI /180);
    ry = (_degrees[0+i] + _offset) * (Math.PI /180);
    x = centerX + _rd * Math.cos(rx);
    y = centerY + _rd * Math.sin(ry);
    ctx.beginPath();
    ctx.lineWidth   = 2;
    ctx.strokeStyle = '#848177';
    // ctx.moveTo(x,y);
    ctx.fillStyle   = "#848177";

    if(sizeWidth <  620){
      ctx.lineTo(x,sizeHeight - (10 * i) - 60);
      ctx.textAlign="left";
      if( v == 4){
        ctx.fillText("Goals",x,sizeHeight - 40);
      }
      if(v == 10){
        ctx.fillText(_labels[i],x , sizeHeight - 70);
      }else if(v == 7){
        ctx.fillText(_labels[i],x , sizeHeight - 60 );
      }else{
        ctx.fillText(_labels[i],x , sizeHeight - 50 );

      }
    }else{
      ctx.lineTo(sizeWidth,y)
      // _labels[i]
      ctx.textAlign="right";
      if( v == 4){
        ctx.fillText("Goals",sizeWidth - 10,y-15);
      }
      if(v == 10){
        ctx.fillText(_labels[i],sizeWidth - 10,y+15);
      }else{
        ctx.fillText(_labels[i],sizeWidth - 10,y+15);
      }
    }

    ctx.stroke();
  });
}
function addLeyend(show_personal){
  marginLeft = 10;
  var canvas = document.getElementById("spider");
  var ctx = canvas.getContext("2d");
  var sizeWidth = ctx.canvas.clientWidth;
  var sizeHeight = ctx.canvas.clientHeight;
  var scaleWidth = sizeWidth/100;
  var scaleHeight = sizeHeight/100;
  ctx.strokeStyle = '#293b47'; //black
  ctx.lineWidth   = 2;
  ctx.beginPath();
  if(sizeWidth <  620){
    _ln  = sizeWidth * .3;

  }else{
    _ln  = sizeWidth * .1;

  }

  marginRight = 0;
  ctx.setLineDash([0]);
  ctx.moveTo(marginLeft,100);
  ctx.lineTo(_ln,100);

  ctx.stroke();
  ctx.closePath();
  ctx.beginPath();
  ctx.font = "bold 16px Arial";
  ctx.fillStyle = '#293b47'; //black
  ctx.textAlign = "left";
  ctx.fillText("Community",marginLeft,120);
  ctx.font = "13px Arial";
  ctx.closePath();

  if(show_personal){
    ctx.beginPath();
    ctx.font = "bold 16px Arial";
    ctx.fillStyle = '#293b47'; //black
    ctx.fillText("Personal",marginLeft ,70);
    ctx.font = "13px Arial";
    ctx.closePath();
    ctx.beginPath();
    ctx.setLineDash([3]);
    ctx.stroke();
    ctx.strokeStyle = 'black'; //black
  }


  if(show_personal){
    ctx.moveTo(marginLeft,50);
    ctx.lineTo(_ln,50);
    ctx.closePath();
    ctx.stroke();
  }

  _labelColors = ["#1786e0", "#e23d3d","#2dc463"]

  _labelColors.forEach(function(l,i){
    ctx.strokeStyle = '#293b47'; //black
    ctx.setLineDash([0]);
    ctx.beginPath();
    ctx.fillStyle = l;
    ctx.arc(marginLeft + _ln * (i / 3) + (_ln / 6) ,100,5,0,2*Math.PI)

    ctx.closePath();
    ctx.fill();
    ctx.stroke();

    if(show_personal){
      ctx.strokeStyle = '#293b47'; //brown
      ctx.setLineDash([3]);
      ctx.beginPath();
      ctx.fillStyle = l;
      ctx.arc( marginLeft + _ln * (i / 3) + (_ln / 6) ,50,5,0,2*Math.PI)

      ctx.closePath();
      ctx.fill();
      ctx.stroke();
    }

  });


}
function addPolygons(values,dashed){
  _MAX_POLIGON_VALUE = 1000;
  _nvalues = [];
  values.forEach(function(v){
    if(v > _MAX_POLIGON_VALUE){
      v = _MAX_POLIGON_VALUE;
    }
    _nv = v * 10 / _MAX_POLIGON_VALUE;
    _nvalues.push(_nv);
  })
  values = _nvalues;
  _degrees = [0,40,80,120,160,200,240,280,320,360];
  _offset = 10; //All lines will be turned with this offset.
  var canvas = document.getElementById("spider");
  var ctx = canvas.getContext("2d");
  var sizeWidth = ctx.canvas.clientWidth;
  var sizeHeight = ctx.canvas.clientHeight;
  var scaleWidth = sizeWidth/100;
  var scaleHeight = sizeHeight/100;

  c = canvas.height * .10;


  centerX = sizeWidth/2;
  centerY = sizeHeight/2;
  r = sizeWidth *.30;
  if(sizeWidth >= sizeHeight){
    r = sizeHeight *.30;
  }

  ctx.lineWidth   = 1.5;
  ctx.strokeStyle = '#293b47';
  ctx.beginPath();

  if(dashed){
    ctx.setLineDash([1]);
    ctx.strokeStyle = '#293b47';
  }
  values.forEach(function(v,i){
    vi = Math.abs(v - _degrees.length);
    _rd  = r - ( vi  *  r / 10 ) //radius distance
    // convert angles to radians. Add offset
    // convert angles to radians. Add offset
    rx = (_degrees[i] + _offset)  * (Math.PI /180);
    ry = (_degrees[i] + _offset) * (Math.PI /180);
    x = centerX + _rd * Math.cos(rx);
    y = centerY + _rd * Math.sin(ry);
    ctx.lineTo(x,y);
    if(dashed){
      ctx.setLineDash([3]);
    }
    ctx.moveTo(x,y);

  });
  ctx.closePath();
  ctx.stroke();
  if(dashed){
    ctx.setLineDash([3]);
  }
  ctx.fillStyle="#1786e0";
  ctx.fillStyle="#e23d3d";
  ctx.fillStyle="#2dc463";
  values.forEach(function(v,i){
    vi = Math.abs(v - _degrees.length);
    _rd  = r - ( vi  *  r / 10 ) //radius distance
    // convert angles to radians. Add offset
    // convert angles to radians. Add offset
    rx = (_degrees[i] + _offset)  * (Math.PI /180);
    ry = (_degrees[i] + _offset) * (Math.PI /180);
    x = centerX + _rd * Math.cos(rx);
    y = centerY + _rd * Math.sin(ry);

    if(i < 2 ){
      ctx.fillStyle="#2dc463";
    }else if(i > 2 && i < 5){
      ctx.fillStyle="#e23d3d";
    }else if(i > 5){
      ctx.fillStyle="#1786e0";
    }else if(i >= _degrees.length -1){
      ctx.fillStyle="#2dc463";
    }
    if(i <= _degrees.length -2){
      ctx.beginPath();
      ctx.arc(x,y,3,0,2*Math.PI)
      ctx.closePath();
      ctx.fill();
      ctx.arc(x,y,4,0,2*Math.PI)
      ctx.stroke();
    }



  });
  ctx.closePath();

}
window.onload = function()
 {

    var elems = Array.prototype.slice.call(document.querySelectorAll('.js-switch'));

    elems.forEach(function(html) {
      var switchery = new Switchery(html, { size: 'small',color:"#468EEB" });
    });

   window.apiClient = new PowerApiClient(function(a){
     window.apiData = a;
     _p1 = apiClient.getUser().obj.gamification.personal["problem.awareness"];
     _p1 += apiClient.getUser().obj.gamification.political["problem.awareness"];
     _p1 += apiClient.getUser().obj.gamification.social["problem.awareness"];

     // ---------------------------------------------------------------------//
     _p2 = apiClient.getUser().obj.gamification.personal["practical.knowledge"];
     _p2 += apiClient.getUser().obj.gamification.political["practical.knowledge"];
     _p2 += apiClient.getUser().obj.gamification.social["practical.knowledge"];

     _p3 = apiClient.getUser().obj.gamification.personal["ready.for.action"];
     _p3 += apiClient.getUser().obj.gamification.political["ready.for.action"];
     _p3 += apiClient.getUser().obj.gamification.social["ready.for.action"];
     changeProgress(_p1,_p2,_p3);

     _l1 = apiClient.getUser().obj.gamification.personal["problem.awareness"];
     _l1 += apiClient.getUser().obj.gamification.personal["practical.knowledge"];
     _l1 += apiClient.getUser().obj.gamification.personal["ready.for.action"];

     _l2 = apiClient.getUser().obj.gamification.political["problem.awareness"];
     _l2 += apiClient.getUser().obj.gamification.political["practical.knowledge"];
     _l2 += apiClient.getUser().obj.gamification.political["ready.for.action"];

     _l3 = apiClient.getUser().obj.gamification.social["problem.awareness"];
     _l3 += apiClient.getUser().obj.gamification.social["practical.knowledge"];
     _l3 += apiClient.getUser().obj.gamification.social["ready.for.action"];

     setProgressPowerBar(_l1,1);
     setProgressPowerBar(_l2,2);
     setProgressPowerBar(_l3,3);

     addPowerBarLevelsPA(_l1);
     addPowerBarLevelsSO(_l2);
     addPowerBarLevelsIN(_l3);
     _totalProgress = _l1 + _l2 + _l3;
     document.getElementById("total_score").innerHTML = _totalProgress;
     setWardenProgress(_totalProgress);
     resize();

   });


 }
 document.getElementsByClassName("js-switch")[2].addEventListener("change",function(e){
   toggleSpider();
 })
 document.getElementsByClassName("js-switch")[1].addEventListener("change",function(e){
   toggleLevelsPersonalImpact();
 })
 document.getElementsByClassName("js-switch")[0].addEventListener("change",function(e){
   toggleLevelsPersonalPreparedness();
 })
 function initPoligons(toggleStatus){
   initSpider();
   // addGoals();
   addImpact();
   addSize(apiClient.getGlobal().obj.participants);

   // apiClient.getGlobal().obj.gamification.social
   _dataGlobal = apiClient.getGlobal().obj.gamification;
   _dataGlobalSocial    = _dataGlobal.social;
   _dataGlobalPolitical = _dataGlobal.political;
   _dataGlobalPersonal  = _dataGlobal.personal;

   addPolygons([    _dataGlobalSocial["practical.knowledge"],
                    _dataGlobalSocial["ready.for.action"],
                    _dataGlobalSocial["problem.awareness"],
                    _dataGlobalPolitical["practical.knowledge"],
                    _dataGlobalPolitical["ready.for.action"],
                    _dataGlobalPolitical["problem.awareness"],
                    _dataGlobalPersonal["practical.knowledge"],
                    _dataGlobalPersonal["ready.for.action"],
                    _dataGlobalPersonal["problem.awareness"],
                    _dataGlobalSocial["practical.knowledge"],
                  ],false); //global

   if(toggleStatus){
     _dataPersonal = apiClient.getUser().obj.gamification;
     _dataPersonalSocial    = _dataPersonal.social;
     _dataPersonalPolitical = _dataPersonal.political;
     _dataPersonalPersonal  = _dataPersonal.personal;
     addPolygons([    _dataPersonalSocial["practical.knowledge"],
                      _dataPersonalSocial["ready.for.action"],
                      _dataPersonalSocial["problem.awareness"],
                      _dataPersonalPolitical["practical.knowledge"],
                      _dataPersonalPolitical["ready.for.action"],
                      _dataPersonalPolitical["problem.awareness"],
                      _dataPersonalPersonal["practical.knowledge"],
                      _dataPersonalPersonal["ready.for.action"],
                      _dataPersonalPersonal["problem.awareness"],
                      _dataPersonalSocial["practical.knowledge"]
                    ],true); //personal
   }
   addLeyend(toggleStatus);

 }
 function toggleSpider(){
   // _switchS = document.getElementById("myonoffswitch");
   _checked = document.getElementsByClassName("js-switch")[2].checked;
   initPoligons(_checked)
 }
 function toggleLevelsPersonalImpact(){
   _checked = document.getElementsByClassName("js-switch")[1].checked;
   pList = document.getElementsByClassName("powerBarLevelsWrapper")

   for (var i = 0; i < pList.length; i++) {
      (!_checked) ? pList[i].style.display = "none" : pList[i].style.display = "block";
   }
 }
 function toggleLevelsPersonalPreparedness(){
   _checked = document.getElementsByClassName("js-switch")[0].checked;
   pList = document.getElementsByClassName("circularLevelsWrapper")

   for (var i = 0; i < pList.length; i++) {
      (!_checked) ? pList[i].style.display = "none" : pList[i].style.display = "block";
   }
 }
 function toggleHideableArea(el){
   var w = window.innerWidth;
   _hideable_area = el.parentElement.getElementsByClassName("hideable-area")[0];
   if(_hideable_area.style.display != "none"){
     _hideable_area.style.display = "none"
     el.parentElement.style.height = "100px";
     el.classList.remove("arrow-down");
     el.classList.add("arrow-up");
   }else{
     _hideable_area.style.display = "block"
     if(el.getAttribute("data") == "1" && w < 650){
       el.parentElement.style.height = "780px";
     }else{
       el.parentElement.style.height = "auto";

     }
     el.classList.remove("arrow-up");
     el.classList.add("arrow-down");

   }
 }
 function resize(){
   _checked = document.getElementsByClassName("js-switch")[2].checked;
   initPoligons(_checked);
   toggleLevelsPersonalImpact();
   toggleLevelsPersonalPreparedness();
 }
 function powerPopup(content){
   _content = document.getElementById("powerPopupContent")
   _content.innerHTML = content;
   _els = document.getElementsByClassName("powerPopup");
   for (var i = 0; i < _els.length; i++) {
     _els[i].style.display = "flex";
   }
 }
 function hidePowerPopup(){
   _els = document.getElementsByClassName("powerPopup");
   for (var i = 0; i < _els.length; i++) {
     _els[i].style.display = "none";
   }
 }
function m1(){
   powerPopup("<p>In order to be flood prepared, you need to increase your problem awareness, know-how in flood related issues and become ready to act in case of a flood occurs. Personal preparedness shows how well prepared are you for the case of flooding in these categories. For example if you read an article about flood risk - you increase your awareness, where as if you read about tips to prepare your self - you get points in readiness to act.<p><p>This visualization graphically displays the points you achieved in one of the preparedness categories summed up over the corresponding individual, social and political categories. For example, your problem awareness score is the sum of problem awareness scores of the individual, social and political impact, whereas know-how score is the sum of know how scores of individual, social and politcal.</p>")
}
function m2(){
  powerPopup("<p>Once the progress bar is full, you go to the next level and you fill the bar from the start.</p><p>Show levels displays the level you have already achieved by a colored icon relating to the category where the level has been increased.</p>")
}
function m3(){
  powerPopup("<p>Your boost factor relates to the Competitiobn that you can take part additionally on this platform. With this factor your vote for the idea participating in the contest will be weighted.</p>")
}
function m4(){
  powerPopup("<p>Community Preparedness shows how prepared your local community is in the various areas: awareness, know-how and readinesss to act, on the individual, social and political levels. You can see the scores the community members obtained on average in these categories. Additionally, you can see how many people are in your community currently.</p><p>By toggling the option 'show personal' you can additionally display your personal scores that you obtained in each category. Thus you can see how your level of preparedness contributed to the preparedness of the community. For example, if in one of the cateogires your score is higher that that of the community, it means that your actions on the platform contributed more to the overall preparedness of the community than of an average community member.</p><p>The goal both for yourself and the community is to try to gain an equal amount of points in each of the categories so that you have a full sircle (or a form which rather resembles a circle than a polygon). This means that you are equally well prepared on all 9 categories.</p>")
}
function m5(){
  powerPopup("<p>Flood Warden achievment shows what you achieved in total based on your activities on the platform. It relates to the total points you receive.<p>Once you achieve a 'Beginner' level, you become aware of the need to prepare yourself. On the 'Intermediate' level, you already achieved a certain amount of preparedness. On the 'Advanced' level you can consider yourself to be fully prepared for the case of flooding.</p>")
}
function m6(){
  powerPopup("<p>Flooding is an issue that does not concert only you personally. Personal impact shows how the actions you do on the platform can have impact on individual, social and political levels. For example, if you share a certain issue about flood warning, it has also a social impact. If you attend an event on flood prevention, you show your political participation.</p><p>The visualization graphically displays the points you achieved in each of the impact categories summed up over their corresponding awareness, know-how and readiness. For example, your social score is the sum of social scores of awareness, know-how and readiness to act, whereas your political score is the sum of political scores of awareness, know-how and readiness to act.</p>")
}
</script>
</html>
