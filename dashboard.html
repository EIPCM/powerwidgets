<!DOCTYPE html>
<html style="overflow:hidden;">
  <head>
   <meta charset="utf-8">
   <link rel="stylesheet" type="text/css" href="css/dashboard.css">
   <link href="https://fonts.googleapis.com/css?family=Montserrat" rel="stylesheet">
   <link href="https://fonts.googleapis.com/css?family=Fredoka+One" rel="stylesheet">
   <link href="css/switchery.css" rel="stylesheet">
   <script type="text/javascript" src="js/switchery.js"></script>

   <script type="text/javascript" src="//city.power-h2020.eu/redesign_js/client.js"></script> <!-- need to include this script to talk with the api -->
  </head>

  <body>
    <header class="lan_header">Your Progress Summary</header>
    <div class="dashboard">
      <div class="panel_left">
        <div class="widget_top">
          <div class="widget_title_left lan_title">Total score:</div>
          <div class="widget_score_big" id="total_score">0</div>
        </div>
        <div class="widget">
          <div class="widget_title_left lan_title">Your Achievement:</div>
          <img src="img/dashboard/badge_CI_a.png" class="widget_guage_img" id="achievement_img"/>
          <div class="widget_subsubtitle">Intermediate Flood warden</div>

        </div>
        <div class="widget">
          <div class="widget_title_left lan_title">Your feedback multiplier</div>
          <div class="widget_score_big" id="multiplier_value">0x</div>

        </div>
      </div>
      <div class="panel_right">
        <div class="widget_top">
          <div class="widget_title lan_title">Personal Preparedness</div>
          <div class="widget_gauges_container">
            <div class="widget_gauge">
              <div class="widget_subtitle">
                Problem Awareness
              </div>
              <img src="img/dashboard/pa.png" class="widget_guage_img"/>
              <div class="widget_score_small" id="value_pa">0</div>

            </div>
            <div class="widget_gauge">
              <div class="widget_subtitle">
                Know-<br>How
              </div>
              <img src="img/dashboard/kh.png" class="widget_guage_img"/>
              <div class="widget_score_small" id="value_kh">0</div>

            </div>
            <div class="widget_gauge">
              <div class="widget_subtitle">
                Ready<br>to Act
              </div>
              <img src="img/dashboard/ra.png" class="widget_guage_img"/>
              <div class="widget_score_small" id="value_ra">0</div>

            </div>
          </div>
        </div>
        <div class="widget">
          <div class="widget_title lan_title">Personal Impact</div>
          <div class="widget_gauges_container">
            <div class="widget_gauge">
              <div class="widget_subtitle">
                Individual
              </div>
              <img src="img/dashboard/in.png" class="widget_guage_img"/>
              <div class="widget_score_small" id="value_in">0</div>

            </div>
            <div class="widget_gauge">
              <div class="widget_subtitle">
                Social
              </div>
              <img src="img/dashboard/so.png" class="widget_guage_img"/>
              <div class="widget_score_small" id="value_so">0</div>

            </div>
            <div class="widget_gauge">
              <div class="widget_subtitle">
                Political
              </div>
              <img src="img/dashboard/po.png" class="widget_guage_img"/>
              <div class="widget_score_small" id="value_po">0</div>

            </div>
          </div>
        </div>
      </div>
    </div>
    <script>
    function changeValues(pa,kh,ra,_in,so,po){
      document.getElementById("value_pa").innerHTML = pa;
      document.getElementById("value_kh").innerHTML = kh;
      document.getElementById("value_ra").innerHTML = ra;

      document.getElementById("value_in").innerHTML = _in;
      document.getElementById("value_so").innerHTML = so;
      document.getElementById("value_po").innerHTML = po;
    }
    function setWardenProgress(n){

      var WARDEN_LVL_0 =  500;
      var WARDEN_LVL_1 =  5000;
      var WARDEN_LVL_2 = 9000;
      _w = "0x";
      _img = "badge_{CI}_{l}.png"
      if(n < WARDEN_LVL_0){
        _level = "a";
      }
      if(n >= WARDEN_LVL_0){
        _w = "1x";
        _level = "a";
      }

      if(n >= WARDEN_LVL_1){
        _w = "1.5x";
        _level = "b";
      }

      if(n >= WARDEN_LVL_2){
        _w = "2x";
        _level = "c";
      }
      _img = _img.replace("{CI}",CURRENT_CITY);
      _img = _img.replace("{l}",_level);
      _link = "img/dashboard/"+ _img;
      console.log(_link);
      document.getElementById("achievement_img").setAttribute("src",_link)
      document.getElementById("multiplier_value").innerHTML = _w;
    }
    u    = new URL(window.location);
    _lan = u.searchParams.get("lan");
    _city = u.searchParams.get("city");
    if(_city != null){
      CURRENT_CITY = _city;
    }
    window.onload = function()
     {
       window.apiClient = new PowerApiClient(function(a){
         window.apiData = a;
         _p1 = apiClient.getUser().obj.gamification.personal["problem.awareness"];
         _p1 += apiClient.getUser().obj.gamification.political["problem.awareness"];
         _p1 += apiClient.getUser().obj.gamification.social["problem.awareness"];

         // ---------------------------------------------------------------------//
         _p2 = apiClient.getUser().obj.gamification.personal["practical.knowledge"];
         _p2 += apiClient.getUser().obj.gamification.political["practical.knowledge"];
         _p2 += apiClient.getUser().obj.gamification.social["practical.knowledge"];

         _p3 = apiClient.getUser().obj.gamification.personal["ready.for.action"];
         _p3 += apiClient.getUser().obj.gamification.political["ready.for.action"];
         _p3 += apiClient.getUser().obj.gamification.social["ready.for.action"];
         // ---------------------------------------------------------------------//
          _l1 = apiClient.getUser().obj.gamification.personal["problem.awareness"];
          _l1 += apiClient.getUser().obj.gamification.personal["practical.knowledge"];
          _l1 += apiClient.getUser().obj.gamification.personal["ready.for.action"];

          _l2 = apiClient.getUser().obj.gamification.political["problem.awareness"];
          _l2 += apiClient.getUser().obj.gamification.political["practical.knowledge"];
          _l2 += apiClient.getUser().obj.gamification.political["ready.for.action"];

          _l3 = apiClient.getUser().obj.gamification.social["problem.awareness"];
          _l3 += apiClient.getUser().obj.gamification.social["practical.knowledge"];
          _l3 += apiClient.getUser().obj.gamification.social["ready.for.action"];
         changeValues(_p1,_p2,_p3,_l1,_l2,_l3);
         _totalProgress = _p1 + _p2 + _p3;
         document.getElementById("total_score").innerHTML = _totalProgress;
         setWardenProgress(_totalProgress);
       });
       apiClient.setObjectChangedCallback(function(){
         _p1 = apiClient.getUser().obj.gamification.personal["problem.awareness"];
         _p1 += apiClient.getUser().obj.gamification.political["problem.awareness"];
         _p1 += apiClient.getUser().obj.gamification.social["problem.awareness"];

         // ---------------------------------------------------------------------//
         _p2 = apiClient.getUser().obj.gamification.personal["practical.knowledge"];
         _p2 += apiClient.getUser().obj.gamification.political["practical.knowledge"];
         _p2 += apiClient.getUser().obj.gamification.social["practical.knowledge"];

         _p3 = apiClient.getUser().obj.gamification.personal["ready.for.action"];
         _p3 += apiClient.getUser().obj.gamification.political["ready.for.action"];
         _p3 += apiClient.getUser().obj.gamification.social["ready.for.action"];
         _totalProgress = _p1 + _p2 + _p3;
         document.getElementById("total_score").innerHTML = _totalProgress;
         setWardenProgress(_totalProgress);
      });

     }
    </script>
  </body>
</html>
