<!DOCTYPE html>
<html style="overflow:hidden;">
  <head>
   <meta charset="utf-8">
   <link rel="stylesheet" type="text/css" href="css/dashboard.css">
   <link href="https://fonts.googleapis.com/css?family=Montserrat" rel="stylesheet">
   <link href="https://fonts.googleapis.com/css?family=Fredoka+One" rel="stylesheet">
   <link href="css/switchery.css" rel="stylesheet">
   <script type="text/javascript" src="js/switchery.js"></script>

   <script type="text/javascript" src="//city.power-h2020.eu/redesign_js/client.js"></script> <!-- need to include this script to talk with the api -->
  </head>

  <body>
    <header class="lan_header lan_title_summary"></header>
    <div class="dashboard">
      <div class="panel_left">
        <div class="widget_top">
          <div class="widget_title_left lan_total_score"></div>
          <div class="widget_score_big" id="total_score">0</div>
        </div>
        <div class="widget">
          <div class="widget_title_left lan_your_achievement"></div>
          <img src="img/dashboard/badge_CI_a.png" class="widget_guage_img" id="achievement_img"/>
          <div class="widget_subsubtitle achievement_title"></div>

        </div>
        <div class="widget">
          <div class="widget_title_left lan_your_feedback_multiplier"></div>
          <div class="widget_score_big" id="multiplier_value">0x</div>

        </div>
      </div>
      <div class="panel_right">
        <div class="widget_top">
          <div class="widget_title lan_title_personal_impact"></div>
          <div class="widget_gauges_container">
            <div class="widget_gauge">
              <div class="widget_subtitle problem_awareness">

              </div>
              <img src="img/dashboard/pa.png" class="widget_guage_img"/>
              <div class="widget_score_small" id="value_pa">0</div>

            </div>
            <div class="widget_gauge">
              <div class="widget_subtitle know_how">

              </div>
              <img src="img/dashboard/kh.png" class="widget_guage_img"/>
              <div class="widget_score_small" id="value_kh">0</div>

            </div>
            <div class="widget_gauge">
              <div class="widget_subtitle ready_to_act">

              </div>
              <img src="img/dashboard/ra.png" class="widget_guage_img"/>
              <div class="widget_score_small" id="value_ra">0</div>

            </div>
          </div>
        </div>
        <div class="widget">
          <div class="widget_title lan_personal_impact"></div>
          <div class="widget_gauges_container">
            <div class="widget_gauge">
              <div class="widget_subtitle individual">

              </div>
              <img src="img/dashboard/in.png" class="widget_guage_img"/>
              <div class="widget_score_small" id="value_in">0</div>

            </div>
            <div class="widget_gauge">
              <div class="widget_subtitle social">

              </div>
              <img src="img/dashboard/so.png" class="widget_guage_img"/>
              <div class="widget_score_small" id="value_so">0</div>

            </div>
            <div class="widget_gauge">
              <div class="widget_subtitle political">

              </div>
              <img src="img/dashboard/po.png" class="widget_guage_img"/>
              <div class="widget_score_small" id="value_po">0</div>

            </div>
          </div>
        </div>
      </div>
    </div>
    <script>
    function changeValues(pa,kh,ra,_in,so,po){
      document.getElementById("value_pa").innerHTML = pa;
      document.getElementById("value_kh").innerHTML = kh;
      document.getElementById("value_ra").innerHTML = ra;

      document.getElementById("value_in").innerHTML = _in;
      document.getElementById("value_so").innerHTML = so;
      document.getElementById("value_po").innerHTML = po;
    }
    function setWardenProgress(n){
      var WARDEN_LVL_0 =  500;
      var WARDEN_LVL_1 =  5000;
      var WARDEN_LVL_2 = 9000;

      switch (CURRENT_CITY) {
        case "SA":
        case "JE":
        case "CI":
            _achievement_title = "lan_achievement_flood_warden_{level}"
        case "LE":
            _achievement_title = "lan_achievement_water_guardian_{level}"
          break;
        default:

      }
      _w = "0x";
      _img = "badge_{CI}_{l}.png"
      if(n < WARDEN_LVL_0){
        _level = "a";
        _achievement_title = _achievement_title.replace("{level}","beginner")
      }
      if(n >= WARDEN_LVL_0){
        _w = "1x";
        _level = "a";
        _achievement_title = _achievement_title.replace("{level}","beginner")
      }

      if(n >= WARDEN_LVL_1){
        _w = "1.5x";
        _level = "b";
        _achievement_title = _achievement_title.replace("{level}","intermediate")
      }

      if(n >= WARDEN_LVL_2){
        _w = "2x";
        _level = "c";
        _achievement_title = _achievement_title.replace("{level}","advanced")

      }
      _img = _img.replace("{CI}",CURRENT_CITY);
      _img = _img.replace("{l}",_level);
      _link = "img/dashboard/"+ _img;
      console.log(_link);
      document.getElementsByClassName("achievement_title")[0].innerHTML = _loc[CURRENT_LAN][_achievement_title];
      document.getElementById("achievement_img").setAttribute("src",_link)
      document.getElementById("multiplier_value").innerHTML = _w;
    }
    CURRENT_LAN = "en";
    CURRENT_CITY = "CI";
    u    = new URL(window.location);
    _lan = u.searchParams.get("lan");
    _city = u.searchParams.get("city");
    if(_city != null){
      CURRENT_CITY = _city;
    }
    if(_lan != null){
      CURRENT_LAN = _lan;
    }
    _loc = {
      "en":{
        "lan_title_summary":"Your Progress Summary",
        "lan_total_score":"Total Score:",
        "lan_title_personal_impact":"Personal Preparedness",
        "lan_your_achievement":"Achievement",
        "lan_your_feedback_multiplier":"Your feedback multiplier",
        "lan_personal_impact":"Personal Impact",
        "problem_awareness":"Personal Awareness",
        "know_how":"Know-<br>how",
        "ready_to_act":"Ready<br>to Act",
        "individual":"Individual",
        "social":"Social",
        "political":"Political",
        "lan_achievement_flood_warden_beginner":"Beginner Flood Warden",
        "lan_achievement_flood_warden_intermediate":"Intermediate Flood Warden",
        "lan_achievement_flood_warden_advanced":"Advanced Flood Warden",
        "lan_achievement_water_guardian_beginner":"Beginner Flood Warden",
        "lan_achievement_water_guardian_intermediate":"Intermediate Flood Warden",
        "lan_achievement_water_guardian_advanced":"Advanced Flood Warden",
      },
      "es":{
        "lan_title_summary":"Tu Resumen",
        "lan_total_score":"Puntuación Total",
        "lan_title_personal_impact":"Preparación Personal",
        "lan_your_achievement":"Logro:",
        "lan_your_feedback_multiplier":"Multiplicador de Realimentación",
        "lan_personal_impact":"Impacto",
        "problem_awareness":"Conciencia del <br>problema",
        "know_how":"Saber cómo",
        "ready_to_act":"Listo para <br>actuar",
        "individual":"Individual",
        "social":"Social",
        "political":"Politico",
        "lan_achievement_flood_warden_beginner":"Guardián de Inundaciones Principiante",
        "lan_achievement_flood_warden_intermediate":"Guardián de Inundaciones Intermedio",
        "lan_achievement_flood_warden_advanced":"Guardián de Inundaciones Avanzado",
        "lan_achievement_water_guardian_beginner":"Guardián del agua Principiante",
        "lan_achievement_water_guardian_intermediate":"Guardián del agua Intermedio",
        "lan_achievement_water_guardian_advanced":"Guardián del agua Avanzado",
      },
      "cat":{
        "lan_title_summary":"El teu resum",
        "lan_total_score":"Puntuació total",
        "lan_title_personal_impact":"Impacte Personall",
        "lan_your_achievement":"Assoliment:",
        "lan_your_feedback_multiplier":"Multiplicador per valoracions",
        "lan_personal_impact":"Impacte",
        "problem_awareness":"Conscienciació <br>del problema",
        "know_how":"Coneixements",
        "ready_to_act":"Preparat",
        "individual":"Individual",
        "social":"Social",
        "political":"Polític",
        "lan_achievement_flood_warden_beginner":"Guardián de Inundaciones Principiante",
        "lan_achievement_flood_warden_intermediate":"Guardián de Inundaciones Intermedio",
        "lan_achievement_flood_warden_advanced":"Guardián de Inundaciones Avanzado",
        "lan_achievement_water_guardian_beginner":"Guardià d’Aigua Principiant",
        "lan_achievement_water_guardian_intermediate":"Guardià d’Aigua Intermedi",
        "lan_achievement_water_guardian_advanced":"Guardià d’Aigua Avançat",
      },
      "he":{
        "lan_title_summary":"את הסיכום שלך",
        "lan_total_score":"תוצאה סופית",
        "lan_title_personal_impact":"דוגמא אישית",
        "lan_your_achievement":"ההישג שלך",
        "lan_your_feedback_multiplier":"שקלול נקודות",
        "lan_personal_impact":"השפעה",
        "problem_awareness":"בעיה<br>מודעות",
        "know_how":"בקיאות בנושא",
        "ready_to_act":"מוכנות לפעול בנושא",
        "individual":"פרטי",
        "social":"חברתי",
        "political":"פוליטי",
        "lan_achievement_flood_warden_beginner":"למתחם המבול",
        "lan_achievement_flood_warden_intermediate":"מנהל המבול הבינוני",
        "lan_achievement_flood_warden_advanced":"מתקדם המבול המבול",
        "lan_achievement_water_guardian_beginner":"למתחם המבול",
        "lan_achievement_water_guardian_intermediate":"מנהל המבול הבינוני",
        "lan_achievement_water_guardian_advanced":"מתקדם המבול המבול",
      },
      "ar":{
        "lan_title_summary":"ملخصك",
        "lan_total_score":"مجموع النقاط",
        "lan_title_personal_impact":"مثال شخصي",
        "lan_your_achievement":"موهلات",
        "lan_your_feedback_multiplier":"عامل منح الحافز",
        "lan_personal_impact":"جاهزية المجتمع وتأثيره",
        "problem_awareness":"مشكلة الوعي",
        "know_how":"المعرفة في الموضوع",
        "ready_to_act":"جاهزية للعمل في المجال",
        "individual":"شخصي",
        "social":"اجتماعي",
        "political":"سياسي",
        "lan_achievement_flood_warden_beginner":"مذيع الفيضان",
        "lan_achievement_flood_warden_intermediate":"وسيط فيضان اردن",
        "lan_achievement_flood_warden_advanced":"المتقدم فيضان المرشد",
        "lan_achievement_water_guardian_beginner":"مذيع الفيضان",
        "lan_achievement_water_guardian_intermediate":"وسيط فيضان اردن",
        "lan_achievement_water_guardian_advanced":"المتقدم فيضان المرشد",
      },

    }
    function setLan(){

        for (k in _loc[CURRENT_LAN]){
          // _element = document.getElementById(k);
          // if(_element !=null){
          //     _element.innerHTML = _loc[CURRENT_LAN][k];
          // }
          lan_classes = document.getElementsByClassName(k);
          for (var i = 0; i < lan_classes.length; i++) {
            lan_classes[i].innerHTML = _loc[CURRENT_LAN][k];
          }
        }
    }
    setLan();
    window.onload = function()
     {
       window.apiClient = new PowerApiClient(function(a){
         window.apiData = a;
         _p1 = apiClient.getUser().obj.gamification.personal["problem.awareness"];
         _p1 += apiClient.getUser().obj.gamification.political["problem.awareness"];
         _p1 += apiClient.getUser().obj.gamification.social["problem.awareness"];

         // ---------------------------------------------------------------------//
         _p2 = apiClient.getUser().obj.gamification.personal["practical.knowledge"];
         _p2 += apiClient.getUser().obj.gamification.political["practical.knowledge"];
         _p2 += apiClient.getUser().obj.gamification.social["practical.knowledge"];

         _p3 = apiClient.getUser().obj.gamification.personal["ready.for.action"];
         _p3 += apiClient.getUser().obj.gamification.political["ready.for.action"];
         _p3 += apiClient.getUser().obj.gamification.social["ready.for.action"];
         // ---------------------------------------------------------------------//
          _l1 = apiClient.getUser().obj.gamification.personal["problem.awareness"];
          _l1 += apiClient.getUser().obj.gamification.personal["practical.knowledge"];
          _l1 += apiClient.getUser().obj.gamification.personal["ready.for.action"];

          _l2 = apiClient.getUser().obj.gamification.political["problem.awareness"];
          _l2 += apiClient.getUser().obj.gamification.political["practical.knowledge"];
          _l2 += apiClient.getUser().obj.gamification.political["ready.for.action"];

          _l3 = apiClient.getUser().obj.gamification.social["problem.awareness"];
          _l3 += apiClient.getUser().obj.gamification.social["practical.knowledge"];
          _l3 += apiClient.getUser().obj.gamification.social["ready.for.action"];
         changeValues(_p1,_p2,_p3,_l1,_l2,_l3);
         _totalProgress = _p1 + _p2 + _p3;
         document.getElementById("total_score").innerHTML = _totalProgress;
         setWardenProgress(_totalProgress);
       });
       apiClient.setObjectChangedCallback(function(){
         _p1 = apiClient.getUser().obj.gamification.personal["problem.awareness"];
         _p1 += apiClient.getUser().obj.gamification.political["problem.awareness"];
         _p1 += apiClient.getUser().obj.gamification.social["problem.awareness"];

         // ---------------------------------------------------------------------//
         _p2 = apiClient.getUser().obj.gamification.personal["practical.knowledge"];
         _p2 += apiClient.getUser().obj.gamification.political["practical.knowledge"];
         _p2 += apiClient.getUser().obj.gamification.social["practical.knowledge"];

         _p3 = apiClient.getUser().obj.gamification.personal["ready.for.action"];
         _p3 += apiClient.getUser().obj.gamification.political["ready.for.action"];
         _p3 += apiClient.getUser().obj.gamification.social["ready.for.action"];
         _totalProgress = _p1 + _p2 + _p3;
         document.getElementById("total_score").innerHTML = _totalProgress;
         setWardenProgress(_totalProgress);
      });

     }
    </script>
  </body>
</html>
